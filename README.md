# 前方交会程序

这个程序用于根据匹配点进行前方交会，计算3D点坐标，为后续的光束法平差做准备。

## 功能

- 读取ori文件中的相机参数
- 读取匹配点文件
- 使用线性三角测量法计算3D点坐标
- 计算重投影误差并过滤不良点
- 导出3D点坐标到CSV文件
- 导出点云为PLY格式，可在MeshLab等软件中可视化

## 依赖

- OpenCV 4.x
- Eigen 3.x
- C++17标准库

## 编译方法

```bash
mkdir build
cd build
cmake ..
make
```

## 使用方法

```bash
./bin/forward_intersect [数据目录] [匹配结果目录] [输出目录]
```

参数说明：
- 数据目录：包含tif和ori文件的目录，默认为"../ImageMatcher/data"
- 匹配结果目录：包含匹配点CSV文件的目录，默认为"../ImageMatcher/output"
- 输出目录：3D点输出目录，默认为"./output"

## 输出文件

- points3D.csv：包含所有3D点的坐标和观测数量
- point_observations.csv：包含3D点和2D观测点的对应关系
- point_cloud.ply：点云文件，可在MeshLab等软件中可视化

## 算法说明

程序使用线性三角测量法计算3D点坐标，主要步骤如下：

1. 读取ori文件中的相机内参和外参
2. 读取匹配点文件
3. 对每对匹配点进行前方交会
4. 计算重投影误差，过滤不良点
5. 导出3D点坐标和观测关系

前方交会的数学原理是利用两个或多个影像上的同名点，根据共线方程，求解空间点的三维坐标。程序中使用了线性三角测量法，通过SVD分解求解超定方程组。 